# WebSocket support configuration
map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}

# Protocol detection configuration
map $http_x_forwarded_proto $proxy_x_forwarded_proto {
    default $http_x_forwarded_proto;
    '' $scheme;
}

# Forwarded port configuration
map $http_x_forwarded_port $proxy_x_forwarded_port {
    default $http_x_forwarded_port;
    '' $server_port;
}